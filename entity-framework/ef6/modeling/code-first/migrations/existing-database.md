---
title: 既存のデータベースを使用した Code First Migrations-EF6
author: divega
ms.date: 10/23/2016
ms.assetid: f0cc4f93-67dd-4664-9753-0a9f913814db
ms.openlocfilehash: eb7948eafb1322cabcf69b47bd5411f762fe8498
ms.sourcegitcommit: 708b18520321c587b2046ad2ea9fa7c48aeebfe5
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/09/2019
ms.locfileid: "72182581"
---
# <a name="code-first-migrations-with-an-existing-database"></a><span data-ttu-id="16d8f-102">既存のデータベースでの Code First Migrations</span><span class="sxs-lookup"><span data-stu-id="16d8f-102">Code First Migrations with an existing database</span></span>
> [!NOTE]
> <span data-ttu-id="16d8f-103">**Ef 4.3 以降のみ**-このページで説明した機能、api などが Entity Framework 4.1 で導入されました。</span><span class="sxs-lookup"><span data-stu-id="16d8f-103">**EF4.3 Onwards Only** - The features, APIs, etc. discussed in this page were introduced in Entity Framework 4.1.</span></span> <span data-ttu-id="16d8f-104">以前のバージョンを使用している場合、一部またはすべての情報は適用されません。</span><span class="sxs-lookup"><span data-stu-id="16d8f-104">If you are using an earlier version, some or all of the information does not apply.</span></span>

<span data-ttu-id="16d8f-105">この記事では、Entity Framework によって作成されていない既存のデータベースで Code First Migrations を使用する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="16d8f-105">This article covers using Code First Migrations with an existing database, one that wasn’t created by Entity Framework.</span></span>

> [!NOTE]
> <span data-ttu-id="16d8f-106">この記事では、基本的なシナリオでの Code First Migrations の使用方法を理解していることを前提としています。</span><span class="sxs-lookup"><span data-stu-id="16d8f-106">This article assumes you know how to use Code First Migrations in basic scenarios.</span></span> <span data-ttu-id="16d8f-107">そうでない場合は、続行する前に[Code First Migrations](~/ef6/modeling/code-first/migrations/index.md)を読む必要があります。</span><span class="sxs-lookup"><span data-stu-id="16d8f-107">If you don’t, then you’ll need to read [Code First Migrations](~/ef6/modeling/code-first/migrations/index.md) before continuing.</span></span>

## <a name="screencasts"></a><span data-ttu-id="16d8f-108">キャスト</span><span class="sxs-lookup"><span data-stu-id="16d8f-108">Screencasts</span></span>

<span data-ttu-id="16d8f-109">この記事で説明しているスクリーンキャストをご覧になりたい場合は、次の2つのビデオでこの記事と同じ内容をご確認ください。</span><span class="sxs-lookup"><span data-stu-id="16d8f-109">If you'd rather watch a screencast than read this article, the following two videos cover the same content as this article.</span></span>

### <a name="video-one-migrations---under-the-hood"></a><span data-ttu-id="16d8f-110">ビデオ 1:"移行-内部"</span><span class="sxs-lookup"><span data-stu-id="16d8f-110">Video One: "Migrations - Under the Hood"</span></span>

<span data-ttu-id="16d8f-111">[このスクリーンキャスト](https://channel9.msdn.com/blogs/ef/migrations-under-the-hood)では、モデルの変更を検出するために、移行によってモデルに関する情報を追跡および使用する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="16d8f-111">[This screencast](https://channel9.msdn.com/blogs/ef/migrations-under-the-hood) covers how migrations tracks and uses information about the model to detect model changes.</span></span>

### <a name="video-two-migrations---existing-databases"></a><span data-ttu-id="16d8f-112">ビデオ 2:"移行-既存のデータベース"</span><span class="sxs-lookup"><span data-stu-id="16d8f-112">Video Two: "Migrations - Existing Databases"</span></span>

<span data-ttu-id="16d8f-113">[このスクリーンキャスト](https://channel9.msdn.com/blogs/ef/migrations-existing-databases)では、前のビデオの概念に基づいて、既存のデータベースで移行を有効にして使用する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="16d8f-113">Building on the concepts from the previous video, [this screencast](https://channel9.msdn.com/blogs/ef/migrations-existing-databases) covers how to enable and use migrations with an existing database.</span></span>

## <a name="step-1-create-a-model"></a><span data-ttu-id="16d8f-114">手順 1:モデルを作成する</span><span class="sxs-lookup"><span data-stu-id="16d8f-114">Step 1: Create a model</span></span>

<span data-ttu-id="16d8f-115">最初の手順として、既存のデータベースを対象とする Code First モデルを作成します。</span><span class="sxs-lookup"><span data-stu-id="16d8f-115">Your first step will be to create a Code First model that targets your existing database.</span></span> <span data-ttu-id="16d8f-116">この方法の詳細なガイダンスについては、「[既存のデータベースへの Code First](~/ef6/modeling/code-first/workflows/existing-database.md) 」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="16d8f-116">The [Code First to an Existing Database](~/ef6/modeling/code-first/workflows/existing-database.md) topic provides detailed guidance on how to do this.</span></span>

>[!NOTE]
> <span data-ttu-id="16d8f-117">データベーススキーマを変更する必要があるモデルに変更を加える前に、このトピックの残りの手順に従うことが重要です。</span><span class="sxs-lookup"><span data-stu-id="16d8f-117">It is important to follow the rest of the steps in this topic before making any changes to your model that would require changes to the database schema.</span></span> <span data-ttu-id="16d8f-118">次の手順では、モデルをデータベーススキーマと同期させる必要があります。</span><span class="sxs-lookup"><span data-stu-id="16d8f-118">The following steps require the model to be in-sync with the database schema.</span></span>

## <a name="step-2-enable-migrations"></a><span data-ttu-id="16d8f-119">手順 2:移行を有効にする</span><span class="sxs-lookup"><span data-stu-id="16d8f-119">Step 2: Enable Migrations</span></span>

<span data-ttu-id="16d8f-120">次の手順では、移行を有効にします。</span><span class="sxs-lookup"><span data-stu-id="16d8f-120">The next step is to enable migrations.</span></span> <span data-ttu-id="16d8f-121">これを行うには、パッケージマネージャーコンソールで [**移行を有効に**する] コマンドを実行します。</span><span class="sxs-lookup"><span data-stu-id="16d8f-121">You can do this by running the **Enable-Migrations** command in Package Manager Console.</span></span>

<span data-ttu-id="16d8f-122">このコマンドを実行すると、移行という名前のフォルダーがソリューションに作成され、Configuration という名前の単一のクラスが配置されます。</span><span class="sxs-lookup"><span data-stu-id="16d8f-122">This command will create a folder in your solution called Migrations, and put a single class inside it called Configuration.</span></span> <span data-ttu-id="16d8f-123">構成クラスでは、アプリケーションの移行を構成します。詳細については、 [Code First Migrations](~/ef6/modeling/code-first/migrations/index.md)のトピックを参照してください。</span><span class="sxs-lookup"><span data-stu-id="16d8f-123">The Configuration class is where you configure migrations for your application, you can find out more about it in the [Code First Migrations](~/ef6/modeling/code-first/migrations/index.md) topic.</span></span>

## <a name="step-3-add-an-initial-migration"></a><span data-ttu-id="16d8f-124">手順 3:初期移行を追加する</span><span class="sxs-lookup"><span data-stu-id="16d8f-124">Step 3: Add an initial migration</span></span>

<span data-ttu-id="16d8f-125">移行が作成され、ローカルデータベースに適用されたら、これらの変更を他のデータベースに適用することもできます。</span><span class="sxs-lookup"><span data-stu-id="16d8f-125">Once migrations have been created and applied to the local database you may also want to apply these changes to other databases.</span></span> <span data-ttu-id="16d8f-126">たとえば、ローカルデータベースがテストデータベースであり、最終的には、実稼働データベースやその他の開発者のテストデータベースにもその変更を適用することが必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="16d8f-126">For example, your local database may be a test database and you may ultimately want to also apply the changes to a production database and/or other developers test databases.</span></span> <span data-ttu-id="16d8f-127">この手順には2つのオプションがあり、他のデータベースのスキーマが空であるか、または現在ローカルデータベースのスキーマと一致しているかに関係なく、選択する必要があります。</span><span class="sxs-lookup"><span data-stu-id="16d8f-127">There are two options for this step and the one you should pick depends whether or not the schema of any other databases is empty or currently matches the schema of the local database.</span></span>

-   <span data-ttu-id="16d8f-128">**Option One:既存のスキーマを開始点として使用します。**</span><span class="sxs-lookup"><span data-stu-id="16d8f-128">**Option One: Use existing schema as starting point.**</span></span> <span data-ttu-id="16d8f-129">この方法は、移行先の他のデータベースが今後適用されるときに、現在のローカルデータベースと同じスキーマを持つ場合に使用してください。</span><span class="sxs-lookup"><span data-stu-id="16d8f-129">You should use this approach when other databases that migrations will be applied to in the future will have the same schema as your local database currently has.</span></span> <span data-ttu-id="16d8f-130">たとえば、ローカルのテストデータベースが現在運用データベースの v1 に一致していて、後でこれらの移行を適用して運用データベースを v2 に更新する場合に、これを使用します。</span><span class="sxs-lookup"><span data-stu-id="16d8f-130">For example, you might use this if your local test database currently matches v1 of your production database and you will later apply these migrations to update your production database to v2.</span></span>
-   <span data-ttu-id="16d8f-131">**Option 2:空のデータベースを開始点として使用します。**</span><span class="sxs-lookup"><span data-stu-id="16d8f-131">**Option Two: Use empty database as starting point.**</span></span> <span data-ttu-id="16d8f-132">今後、移行が適用される他のデータベースが空である (または存在しない) 場合は、この方法を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="16d8f-132">You should use this approach when other databases that migrations will be applied to in the future are empty (or do not exist yet).</span></span> <span data-ttu-id="16d8f-133">たとえば、テストデータベースを使用してアプリケーションの開発を開始したが、移行を使用せずに、実稼働データベースを最初から作成したい場合に、この方法を使用することができます。</span><span class="sxs-lookup"><span data-stu-id="16d8f-133">For example, you might use this if you started developing your application using a test database but without using migrations and you will later want to create a production database from scratch.</span></span>

### <a name="option-one-use-existing-schema-as-a-starting-point"></a><span data-ttu-id="16d8f-134">オプション 1:既存のスキーマを開始点として使用する</span><span class="sxs-lookup"><span data-stu-id="16d8f-134">Option One: Use existing schema as a starting point</span></span>

<span data-ttu-id="16d8f-135">Code First Migrations は、最新の移行に格納されているモデルのスナップショットを使用して、モデルに対する変更を検出します (詳細については、「[チーム環境の Code First Migrations](~/ef6/modeling/code-first/migrations/teams.md)」を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="16d8f-135">Code First Migrations uses a snapshot of the model stored in the most recent migration to detect changes to the model (you can find detailed information about this in [Code First Migrations in Team Environments](~/ef6/modeling/code-first/migrations/teams.md)).</span></span> <span data-ttu-id="16d8f-136">現在のモデルのスキーマがデータベースに既に存在することを前提としているため、現在のモデルをスナップショットとして持つ空 (op なし) の移行を生成します。</span><span class="sxs-lookup"><span data-stu-id="16d8f-136">Since we are going to assume that databases already have the schema of the current model, we will generate an empty (no-op) migration that has the current model as a snapshot.</span></span>

1.  <span data-ttu-id="16d8f-137">パッケージマネージャーコンソールで、[**移行の追加と初期化]** コマンドを実行します。</span><span class="sxs-lookup"><span data-stu-id="16d8f-137">Run the **Add-Migration InitialCreate –IgnoreChanges** command in Package Manager Console.</span></span> <span data-ttu-id="16d8f-138">これにより、現在のモデルをスナップショットとして使用した空の移行が作成されます。</span><span class="sxs-lookup"><span data-stu-id="16d8f-138">This creates an empty migration with the current model as a snapshot.</span></span>
2.  <span data-ttu-id="16d8f-139">パッケージマネージャーコンソールで、**データベースの更新**コマンドを実行します。</span><span class="sxs-lookup"><span data-stu-id="16d8f-139">Run the **Update-Database** command in Package Manager Console.</span></span> <span data-ttu-id="16d8f-140">これにより、データベースへの InitialCreate 移行が適用されます。</span><span class="sxs-lookup"><span data-stu-id="16d8f-140">This will apply the InitialCreate migration to the database.</span></span> <span data-ttu-id="16d8f-141">実際の移行には変更は含まれていないため、この移行が既に適用されていることを示す行を \_ @ no__t 1MigrationsHistory テーブルに追加するだけです。</span><span class="sxs-lookup"><span data-stu-id="16d8f-141">Since the actual migration doesn’t contain any changes, it will simply add a row to the \_\_MigrationsHistory table indicating that this migration has already been applied.</span></span>

### <a name="option-two-use-empty-database-as-a-starting-point"></a><span data-ttu-id="16d8f-142">オプション 2:開始点として空のデータベースを使用する</span><span class="sxs-lookup"><span data-stu-id="16d8f-142">Option Two: Use empty database as a starting point</span></span>

<span data-ttu-id="16d8f-143">このシナリオでは、ローカルデータベースに既に存在するテーブルを含めて、データベース全体を最初から作成できるように移行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="16d8f-143">In this scenario we need Migrations to be able to create the entire database from scratch – including the tables that are already present in our local database.</span></span> <span data-ttu-id="16d8f-144">既存のスキーマを作成するロジックを含む InitialCreate 移行を生成します。</span><span class="sxs-lookup"><span data-stu-id="16d8f-144">We’re going to generate an InitialCreate migration that includes logic to create the existing schema.</span></span> <span data-ttu-id="16d8f-145">次に、この移行が既に適用されているように、既存のデータベースを表示します。</span><span class="sxs-lookup"><span data-stu-id="16d8f-145">We’ll then make our existing database look like this migration has already been applied.</span></span>

1.  <span data-ttu-id="16d8f-146">パッケージマネージャーコンソールで、移行  **InitialCreate** コマンドを実行します。</span><span class="sxs-lookup"><span data-stu-id="16d8f-146">Run the **Add-Migration InitialCreate** command in Package Manager Console.</span></span> <span data-ttu-id="16d8f-147">これにより、既存のスキーマを作成するための移行が作成されます。</span><span class="sxs-lookup"><span data-stu-id="16d8f-147">This creates a migration to create the existing schema.</span></span>
2.  <span data-ttu-id="16d8f-148">新しく作成された移行の Up メソッドのすべてのコードをコメントアウトします。</span><span class="sxs-lookup"><span data-stu-id="16d8f-148">Comment out all code in the Up method of the newly created migration.</span></span> <span data-ttu-id="16d8f-149">これにより、既に存在しているすべてのテーブルを再作成することなく、ローカルデータベースへの移行を "適用" できます。</span><span class="sxs-lookup"><span data-stu-id="16d8f-149">This will allow us to ‘apply’ the migration to the local database without trying to recreate all the tables etc. that already exist.</span></span>
3.  <span data-ttu-id="16d8f-150">パッケージマネージャーコンソールで、**データベースの更新**コマンドを実行します。</span><span class="sxs-lookup"><span data-stu-id="16d8f-150">Run the **Update-Database** command in Package Manager Console.</span></span> <span data-ttu-id="16d8f-151">これにより、データベースへの InitialCreate 移行が適用されます。</span><span class="sxs-lookup"><span data-stu-id="16d8f-151">This will apply the InitialCreate migration to the database.</span></span> <span data-ttu-id="16d8f-152">実際の移行には変更が含まれていないため (一時的にコメントアウトされているため)、この移行が既に適用されていることを示す \_ @ no__t テーブルに行を追加するだけです。</span><span class="sxs-lookup"><span data-stu-id="16d8f-152">Since the actual migration doesn’t contain any changes (because we temporarily commented them out), it will simply add a row to the \_\_MigrationsHistory table indicating that this migration has already been applied.</span></span>
4.  <span data-ttu-id="16d8f-153">Up メソッドのコードのコメントを解除します。</span><span class="sxs-lookup"><span data-stu-id="16d8f-153">Un-comment the code in the Up method.</span></span> <span data-ttu-id="16d8f-154">これは、この移行が今後のデータベースに適用されるときに、ローカルデータベースに既に存在していたスキーマが移行によって作成されることを意味します。</span><span class="sxs-lookup"><span data-stu-id="16d8f-154">This means that when this migration is applied to future databases, the schema that already existed in the local database will be created by migrations.</span></span>

## <a name="things-to-be-aware-of"></a><span data-ttu-id="16d8f-155">注意点</span><span class="sxs-lookup"><span data-stu-id="16d8f-155">Things to be aware of</span></span>

<span data-ttu-id="16d8f-156">既存のデータベースに対して移行を使用する場合は、注意が必要な点がいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="16d8f-156">There are a few things you need to be aware of when using Migrations against an existing database.</span></span>

### <a name="defaultcalculated-names-may-not-match-existing-schema"></a><span data-ttu-id="16d8f-157">既定/計算された名前が既存のスキーマと一致しない場合がある</span><span class="sxs-lookup"><span data-stu-id="16d8f-157">Default/calculated names may not match existing schema</span></span>

<span data-ttu-id="16d8f-158">移行では、移行をスキャフォールディングするときに、列およびテーブルの名前を明示的に指定します。</span><span class="sxs-lookup"><span data-stu-id="16d8f-158">Migrations explicitly specifies names for columns and tables when it scaffolds a migrations.</span></span> <span data-ttu-id="16d8f-159">ただし、移行を適用するときに、移行によって既定の名前が計算されるデータベースオブジェクトは他にもあります。</span><span class="sxs-lookup"><span data-stu-id="16d8f-159">However, there are other database objects that Migrations calculates a default name for when applying the migrations.</span></span> <span data-ttu-id="16d8f-160">これには、インデックスと外部キー制約が含まれます。</span><span class="sxs-lookup"><span data-stu-id="16d8f-160">This includes indexes and foreign key constraints.</span></span> <span data-ttu-id="16d8f-161">既存のスキーマを対象とする場合、これらの計算された名前はデータベースに実際に存在するものと一致しない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="16d8f-161">When targeting an existing schema, these calculated names may not match what actually exists in your database.</span></span>

<span data-ttu-id="16d8f-162">このことを認識する必要がある場合の例を次に示します。</span><span class="sxs-lookup"><span data-stu-id="16d8f-162">Here are some examples of when you need to be aware of this:</span></span>

<span data-ttu-id="16d8f-163">**(オプション 1) を使用した場合は、次のようになります。既存のスキーマを開始点として使用する (手順 3:** )</span><span class="sxs-lookup"><span data-stu-id="16d8f-163">**If you used ‘Option One: Use existing schema as a starting point’ from Step 3:**</span></span>

-   <span data-ttu-id="16d8f-164">モデルの今後の変更で、別の名前のデータベースオブジェクトを変更または削除する必要がある場合は、スキャフォールディングの移行を変更して正しい名前を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="16d8f-164">If future changes in your model require changing or dropping one of the database objects that is named differently, you will need to modify the scaffolded migration to specify the correct name.</span></span> <span data-ttu-id="16d8f-165">移行 Api には、これを可能にするオプションの Name パラメーターがあります。</span><span class="sxs-lookup"><span data-stu-id="16d8f-165">The Migrations APIs have an optional Name parameter that allows you to do this.</span></span>
    <span data-ttu-id="16d8f-166">たとえば、既存のスキーマに、IndexFk @ no__t-0ブログ Id という名前のインデックスを持つブログ Id 外部キー列を含む Post テーブルがあるとします。</span><span class="sxs-lookup"><span data-stu-id="16d8f-166">For example, your existing schema may have a Post table with a BlogId foreign key column that has an index named IndexFk\_BlogId.</span></span> <span data-ttu-id="16d8f-167">ただし、既定の移行では、このインデックスの名前は IX @ no__t-0ブログ Id と見なされます。</span><span class="sxs-lookup"><span data-stu-id="16d8f-167">However, by default Migrations would expect this index to be named IX\_BlogId.</span></span> <span data-ttu-id="16d8f-168">このインデックスを削除するようにモデルを変更した場合は、スキャフォールディング DropIndex 呼び出しを変更して IndexFk @ no__t-0ブログ Id 名を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="16d8f-168">If you make a change to your model that results in dropping this index, you will need to modify the scaffolded DropIndex call to specify the IndexFk\_BlogId name.</span></span>

<span data-ttu-id="16d8f-169">オプション2を使用した場合は **If空のデータベースを開始点として使用する手順 3:**</span><span class="sxs-lookup"><span data-stu-id="16d8f-169">**If you used ‘Option Two: Use empty database as a starting point’ from Step 3:**</span></span>

-   <span data-ttu-id="16d8f-170">ローカルデータベースに対して最初の移行のダウンメソッドを実行しようとすると (つまり、空のデータベースに戻す)、誤った名前を使用してインデックスと外部キー制約の削除が試行されるため、エラーが発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="16d8f-170">Trying to run the Down method of the initial migration (that is, reverting to an empty database) against your local database may fail because Migrations will try to drop indexes and foreign key constraints using the incorrect names.</span></span> <span data-ttu-id="16d8f-171">これは、ローカルデータベースにのみ影響します。これは、最初の移行の方法を使用して、他のデータベースが最初から作成されるためです。</span><span class="sxs-lookup"><span data-stu-id="16d8f-171">This will only affect your local database since other databases will be created from scratch using the Up method of the initial migration.</span></span>
    <span data-ttu-id="16d8f-172">既存のローカルデータベースを空の状態にダウングレードする場合は、データベースを削除するか、すべてのテーブルを削除することで、この操作を手動で行うことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="16d8f-172">If you want to downgrade your existing local database to an empty state it is easiest to do this manually, either by dropping the database or dropping all the tables.</span></span> <span data-ttu-id="16d8f-173">この初期ダウングレード後、すべてのデータベースオブジェクトが既定の名前で再作成されるため、この問題は再び発生しません。</span><span class="sxs-lookup"><span data-stu-id="16d8f-173">After this initial downgrade all database objects will be recreated with the default names, so this issue will not present itself again.</span></span>
-   <span data-ttu-id="16d8f-174">モデル内の将来の変更で、異なる名前のデータベースオブジェクトのいずれかを変更または削除する必要がある場合、既存のローカルデータベースに対しては機能しません。名前が既定値と一致しないためです。</span><span class="sxs-lookup"><span data-stu-id="16d8f-174">If future changes in your model require changing or dropping one of the database objects that is named differently, this will not work against your existing local database – since the names won’t match the defaults.</span></span> <span data-ttu-id="16d8f-175">ただし、移行によって選択された既定の名前が使用されるため、' from スクラッチ ' として作成されたデータベースに対して機能します。</span><span class="sxs-lookup"><span data-stu-id="16d8f-175">However, it will work against databases that were created ‘from scratch’ since they will have used the default names chosen by Migrations.</span></span>
    <span data-ttu-id="16d8f-176">これらの変更は、ローカルの既存のデータベースで手動で行うか、または他のコンピューターの場合と同様に、データベースを最初から再作成することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="16d8f-176">You could either make these changes manually on your local existing database, or consider having Migrations recreate your database from scratch – as it will on other machines.</span></span>
-   <span data-ttu-id="16d8f-177">初期移行の Up メソッドを使用して作成されたデータベースは、ローカルデータベースとは若干異なる場合があります。これは、インデックスと外部キー制約に対して計算された既定の名前が使用されるためです。</span><span class="sxs-lookup"><span data-stu-id="16d8f-177">Databases created using the Up method of your initial migration may differ slightly from the local database since the calculated default names for indexes and foreign key constraints will be used.</span></span> <span data-ttu-id="16d8f-178">また、既定で外部キー列にインデックスが作成されるため、余分なインデックスが作成されることもあります。これは、元のローカルデータベースでは発生しない場合があります。</span><span class="sxs-lookup"><span data-stu-id="16d8f-178">You may also end up with extra indexes as Migrations will create indexes on foreign key columns by default – this may not have been the case in your original local database.</span></span>

### <a name="not-all-database-objects-are-represented-in-the-model"></a><span data-ttu-id="16d8f-179">モデルで一部のデータベースオブジェクトが表されていません</span><span class="sxs-lookup"><span data-stu-id="16d8f-179">Not all database objects are represented in the model</span></span>

<span data-ttu-id="16d8f-180">モデルに含まれていないデータベースオブジェクトは、移行によって処理されません。</span><span class="sxs-lookup"><span data-stu-id="16d8f-180">Database objects that are not part of your model will not be handled by Migrations.</span></span> <span data-ttu-id="16d8f-181">これには、ビュー、ストアドプロシージャ、権限、モデルの一部ではないテーブル、追加のインデックスなどが含まれます。</span><span class="sxs-lookup"><span data-stu-id="16d8f-181">This can include views, stored procedures, permissions, tables that are not part of your model, additional indexes, etc.</span></span>

<span data-ttu-id="16d8f-182">このことを認識する必要がある場合の例を次に示します。</span><span class="sxs-lookup"><span data-stu-id="16d8f-182">Here are some examples of when you need to be aware of this:</span></span>

-   <span data-ttu-id="16d8f-183">[手順 3] で選択したオプションに関係なく、モデルの将来の変更によってこれらの追加オブジェクトが変更または削除される必要がある場合、これらの変更を行うことはできません。</span><span class="sxs-lookup"><span data-stu-id="16d8f-183">Regardless of the option you chose in ‘Step 3’, if future changes in your model require changing or dropping these additional objects Migrations will not know to make these changes.</span></span> <span data-ttu-id="16d8f-184">たとえば、追加のインデックスを持つ列を削除した場合、そのインデックスを削除することはできません。</span><span class="sxs-lookup"><span data-stu-id="16d8f-184">For example, if you drop a column that has an additional index on it, Migrations will not know to drop the index.</span></span> <span data-ttu-id="16d8f-185">これをスキャフォールディング移行に手動で追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="16d8f-185">You will need to manually add this to the scaffolded Migration.</span></span>
-   <span data-ttu-id="16d8f-186">オプション2を使用した場合:空のデータベースを開始点として使用します。これらの追加のオブジェクトは、初期移行の上の方法では作成されません。</span><span class="sxs-lookup"><span data-stu-id="16d8f-186">If you used ‘Option Two: Use empty database as a starting point’, these additional objects will not be created by the Up method of your initial migration.</span></span>
    <span data-ttu-id="16d8f-187">必要に応じて、これらの追加のオブジェクトを処理するために、上または下のメソッドを変更できます。</span><span class="sxs-lookup"><span data-stu-id="16d8f-187">You can modify the Up and Down methods to take care of these additional objects if you wish.</span></span> <span data-ttu-id="16d8f-188">移行 API でネイティブにサポートされていないオブジェクト (ビューなど) の場合は、 [sql](https://msdn.microsoft.com/library/system.data.entity.migrations.dbmigration.sql.aspx)メソッドを使用して、未加工の sql を実行し、それらを作成/削除することができます。</span><span class="sxs-lookup"><span data-stu-id="16d8f-188">For objects that are not natively supported in the Migrations API – such as views – you can use the [Sql](https://msdn.microsoft.com/library/system.data.entity.migrations.dbmigration.sql.aspx) method to run raw SQL to create/drop them.</span></span>
